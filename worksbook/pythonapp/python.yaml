---
- hosts: all
  become: yes
  tasks:
  - name: update system
    apt:
      update_cache: yes
  - name: upgrade system
    apt:
      upgrade: yes
    

#python specific setting

- hosts: app
  become: yes
  vars:
    folderpath: /home/ansible/pythonapp
  tasks:
  - name: creating pythonapp directory
    file:
      path: "{{folderpath}}"
      state: directory
      mode: 0755
  - name: installing git
    apt:
      name: git
      state: present
  - name: Installing postgreSql
    apt: 
      name: {{item}}
    with_items:
      - postgresql
      - libpq-dev
      - python-psycopg2

  - hosts: app
    become: yes
    become_user: postgres
    gather_facts: no

    vars:
      dbname: myapp
      dbuser: django
      dbpassword: django
    tasks:
    - name: ensure database is created
      postgresql_db: name={{dbname}}

    - name: ensure user has access to database
      postgresql_user: db={{dbname}} name={{dbuser}} password={{dbpassword}} priv=ALL

    - name: ensure user does not have unnecessory privilege
      postgresql_user: name={{dbuser}} role_attr_flags=NOSUPERUSER,NOCREATEDB
    - name: ensure np other user can acess the database
      postgresql_privs: db={{dbname}} role=PUBLIC type=database priv=ALL state=absent


  
  

